#!/bin/sh
__sh2_check() { __sh2_s="$1"; __sh2_l="$2"; __sh2_m="$3"; if [ "$__sh2_s" -ne 0 ]; then if [ "$__sh2_m" = "return" ]; then return "$__sh2_s"; fi; if [ -n "$__sh2_l" ]; then printf 'Error in %s\n' "$__sh2_l" >&2; fi; exit "$__sh2_s"; fi; }
main() {
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:3:5"
  space_str='hello world'
  __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:4:5"
  quote_str='he said "hello"'
  __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:5:5"
  dollar_str='$HOME and $USER'
  __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:6:5"
  semicolon_str='cmd1; cmd2'
  __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:7:5"
  amp_str='bg &'
  __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:8:5"
  pipe_str='a | b'
  __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:9:5"
  newline_str='line1
line2'
  __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:12:5"
  'echo' "$space_str"; __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}" "exit"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:13:5"
  'echo' "$quote_str"; __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}" "exit"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:14:5"
  'echo' "$dollar_str"; __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}" "exit"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:15:5"
  'echo' "$semicolon_str"; __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}" "exit"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:16:5"
  'echo' "$amp_str"; __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}" "exit"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:19:5"
  {
    case $- in *e*) __sh2_e=1;; *) __sh2_e=0;; esac; set +e;
    __sh2_saved_traps=$(trap);
    __sh2_base="${TMPDIR:-/tmp}/sh2_fifo_$$";
    rm -f "${__sh2_base}_"*;
    mkfifo "${__sh2_base}_0";
    trap 'rm -f "${__sh2_base}_"*' EXIT;
    trap 'rm -f "${__sh2_base}_"*; exit 1' INT TERM QUIT;
    __sh2_fd=3;
    __sh2_fds="";
    eval "exec ${__sh2_fd}<>\"${__sh2_base}_0\"";
    __sh2_fds="$__sh2_fds $__sh2_fd";
    __sh2_fd=$((__sh2_fd + 1));
    ( for fd in $__sh2_fds; do eval "exec $fd>&-"; done; 'printf' '%s' "$pipe_str" )  > "${__sh2_base}_0" & __sh2_p0=$!;
    ( for fd in $__sh2_fds; do eval "exec $fd>&-"; done; 'cat' )  < "${__sh2_base}_0" & __sh2_p1=$!;
    for fd in $__sh2_fds; do eval "exec $fd>&-"; done;
    wait "$__sh2_p0"; __sh2_s0=$?;
    wait "$__sh2_p1"; __sh2_s1=$?;
    __sh2_status=0;
    if [ "$__sh2_s0" -ne 0 ]; then __sh2_status="$__sh2_s0"; fi;
    if [ "$__sh2_s1" -ne 0 ]; then __sh2_status="$__sh2_s1"; fi;
    trap - EXIT INT TERM QUIT;
    rm -f "${__sh2_base}_"*;
    if [ -n "$__sh2_saved_traps" ]; then eval "$__sh2_saved_traps"; fi;
    if [ "$__sh2_e" = 1 ]; then set -e; fi;
    (exit $__sh2_status)
  }
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:22:5"
  combined="$space_str"' '"$quote_str"
  __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}"
  __sh2_loc="tests/fixtures/guardrail_hostile_strings.sh2:23:5"
  'echo' "$combined"; __sh2_status=$?
  __sh2_check "$__sh2_status" "${__sh2_loc:-}" "exit"
  printf '%s\n' 'All hostile strings handled safely'
}
__sh2_status=0
main "$@"
