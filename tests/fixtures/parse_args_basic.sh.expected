__sh2_err_handler() { printf "Error in %s\n" "${__sh2_loc:-unknown}" >&2; }
trap '__sh2_err_handler' ERR
__sh2_parse_args() {
  local out="" key val
  while [ "$#" -gt 0 ]; do
    case "$1" in
      --) shift; while [ "$#" -gt 0 ]; do out="${out}P	${1}
"; shift; done; break ;;
      --*=*) key="${1%%=*}"; val="${1#*=}"; out="${out}F	${key}	${val}
" ;;
      --*) key="$1"; if [ "$#" -gt 1 ] && [ "${2}" != "--" ] && [[ ! "$2" =~ ^-- ]]; then val="$2"; shift; else val="true"; fi; out="${out}F	${key}	${val}
" ;;
      *) out="${out}P	${1}
" ;;
    esac
    shift
  done
  printf '%s' "$out"
}
__sh2_args_flags() { printf '%s' "$1" | awk '/^F\t/ { sub(/^F\t/, ""); print }'; }
__sh2_args_positionals() { printf '%s' "$1" | awk '/^P\t/ { sub(/^P\t/, ""); print }'; }
__sh2_args_flag_get() { printf '%s' "$1" | awk -v k="$2" -F '\t' '{ if (sub(/^F\t/, "")) { if ($1==k) v=$2 } else if ($1==k) v=$2 } END { printf "%s", v }'; }
__sh2_list_get() { printf '%s' "$1" | awk -v i="$2" 'NR==i+1 { printf "%s", $0; exit }'; }
main() {
  __sh2_loc="tests/fixtures/parse_args_basic.sh2:2:3"
  parsed="${__sh2_parsed_args}"
  printf '%s\n' 'reg='"$( __sh2_args_flag_get "$( __sh2_args_flags "$parsed" )" '--registry' )"
  printf '%s\n' 'tag='"$( __sh2_args_flag_get "$( __sh2_args_flags "$parsed" )" '--tag' )"
  printf '%s\n' 'dry='"$( __sh2_args_flag_get "$( __sh2_args_flags "$parsed" )" '--dry-run' )"
  printf '%s\n' 'p0='"$( __sh2_list_get "$( __sh2_args_positionals "$parsed" )" $(( 0 )) )"
  printf '%s\n' 'p1='"$( __sh2_list_get "$( __sh2_args_positionals "$parsed" )" $(( 1 )) )"
}

__sh2_parsed_args="$(__sh2_parse_args "$@")"
__sh2_status=0
main "$@"
